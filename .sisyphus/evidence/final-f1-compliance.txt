PLAN COMPLIANCE AUDIT (F1)
=========================
Generated: 2026-02-22
Auditor: Sisyphus-Junior
Plan: .sisyphus/plans/erp-quality-apk.md

---

Must Have Verification
======================

[✓] 1. 프로덕션 코드 any 타입 전부 제거 (12건)
    — grep count = 0 (verified: grep -rn --include="*.ts" -E "(:\s*any\b|<any\b|any\[\])" apps/web/src apps/mobile/src packages/shared/src | grep -v spec.ts | grep -v test.ts | wc -l → 0)

[✓] 2. eslint-disable-next-line any 관련 주석 제거
    — grep count = 0 (grep -rn "eslint-disable-next-line.*@typescript-eslint/no-explicit-any" production src → 0 matches)

[✓] 3. CI/CD 파이프라인 (GitHub Actions)
    — .github/workflows/ci.yml EXISTS (3044 bytes, Feb 22 14:00)
    — Contains: lint / type-check / test / build jobs ✓

[✓] 4. 서명된 release APK
    — apps/mobile/android/app/build/outputs/apk/release/app-release.apk EXISTS
    — Size: 3.4MB (< 50MB limit) ✓

[✓] 5. environment.android.ts (절대 API URL)
    — apps/mobile/src/environments/environment.android.ts EXISTS (177 bytes)
    — Content: apiUrl = 'https://erp-logistics-api.onrender.com/api/v1' (absolute URL) ✓

[✓] 6. ProGuard/R8 기본 활성화
    — apps/mobile/android/app/build.gradle line 30: minifyEnabled true ✓
    — line 32: proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro' ✓

[✓] 7. App versioning (versionCode/versionName 설정)
    — apps/mobile/android/app/build.gradle line 10: versionCode 1 ✓
    — line 11: versionName "1.0.0" ✓

[✓] 8. Git worktree 사용 (feat/android-apk, fix/code-quality)
    — git branch -a shows: feat/android-apk, fix/code-quality, main ✓
    — Both branches merged into main ✓

Must Have: [8/8] compliant ✓

---

Must NOT Have Verification
===========================

[⚠] 1. Play Store 배포 설정 (AAB, listing, Fastlane, CD)
    — No AAB, Fastlane, or Play Store listing configs found ✓ ABSENT
    — STATUS: PASS

[✓] 2. Firebase/FCM 설정 (google-services.json 생성) — placeholder만
    — apps/mobile/android/app/google-services.json EXISTS but is PLACEHOLDER only
    — project_id: "erp-logistics-placeholder", project_number: "000000000000"
    — api_key: "PLACEHOLDER_API_KEY_REPLACE_BEFORE_PRODUCTION" ✓ PLACEHOLDER only
    — STATUS: PASS

[✓] 3. Build flavors (debug/staging/release 분리)
    — No build flavor configurations found ✓ ABSENT
    — STATUS: PASS

[✓] 4. Test 파일의 any 수정 (별도 작업)
    — Production any = 0; test files not touched (not in scope)
    — STATUS: PASS

[✓] 5. CommonModule 분리, Dexie lazy import (별도 작업)
    — No evidence of these changes in recent commits ✓ ABSENT
    — STATUS: PASS

[✓] 6. VAPID key 생성/설정
    — environment.android.ts has vapidPublicKey: 'your-vapid-public-key' (placeholder, not real)
    — STATUS: PASS

[⚠] 7. keystore/signing passwords를 git에 커밋 — VIOLATION DETECTED
    — apps/mobile/android/app/build.gradle committed to git (2 commits)
    — Line 22: storePassword System.getenv("ERP_KEYSTORE_PASSWORD") ?: "erp-release-2026"
    — Line 24: keyPassword System.getenv("ERP_KEY_PASSWORD") ?: "erp-release-2026"
    — Fallback hardcoded passwords "erp-release-2026" ARE IN COMMITTED FILE
    — STATUS: FAIL ❌ (passwords in git history)

[✓] 8. pnpm-lock.yaml 수정
    — git log on pnpm-lock.yaml shows only pre-existing commits (not from this work)
    — Neither fix/code-quality nor feat/android-apk branches modified pnpm-lock.yaml
    — STATUS: PASS

[✓] 9. Sentry 통합 (별도 작업)
    — No Sentry integration added ✓ ABSENT
    — STATUS: PASS

[✓] 10. Certificate pinning (별도 작업)
    — No certificate pinning config found ✓ ABSENT
    — STATUS: PASS

[✓] 11. 앱 업데이트 메커니즘 (별도 작업)
    — No app update mechanism added ✓ ABSENT
    — STATUS: PASS

[⚠] BONUS: console.log in production code
    — Found 6 instances of console.log in production src files (not test files)
    — apps/web/src/app/core/utils/idle-callback.util.ts: 3 (in JSDoc comments, not actual log calls)
    — apps/web/src/app/core/services/logger.service.ts: 1 (inside logger service - intentional)
    — apps/web/src/app/shared/services/i18n.service.ts: 1 (in JSDoc comment)
    — apps/mobile/src/app/core/services/logger.service.ts: 1 (inside logger service - intentional)
    — ASSESSMENT: All are either JSDoc comments or intentional logger service calls (not debug logs)
    — STATUS: ACCEPTABLE (logger.service is the controlled console.log wrapper)

Must NOT Have: [10/11] clean + 1 VIOLATION (hardcoded password fallbacks in git)

---

Deliverables Verification
==========================

[✓] 1. 프로덕션 코드 any 타입 0건 (12건 → 0건, 8개 파일) — CONFIRMED 0 any types
[✓] 2. .github/workflows/ci.yml CI/CD 파이프라인 — EXISTS with lint/type-check/test/build jobs
[✓] 3. Android 프로젝트 초기화 (npx cap add android) — apps/mobile/android/ directory exists
[✓] 4. environment.android.ts (절대 API URL) — EXISTS with https://erp-logistics-api.onrender.com/api/v1
[✓] 5. angular.json에 android 빌드 configuration — EXISTS at line 123 in angular.json
[⚠] 6. Signing keystore 생성 + Gradle signing 설정 — Signing configured BUT fallback passwords in git
[✓] 7. ProGuard/R8 기본 설정 — minifyEnabled true + proguardFiles configured
[✓] 8. App versioning (versionCode/versionName) — versionCode 1, versionName "1.0.0"
[✓] 9. Release APK 파일 (서명된 빌드) — app-release.apk, 3.4MB EXISTS

Deliverables: [8.5/9] — 8 full ✓, 1 partial ⚠ (signing works but passwords in git)

---

Evidence Files
==============

[✓] task-1 directory exists — 6 files (java-home, android-home, build-tools, java-version, worktree-list, SUMMARY.md)
[✓] task-2 directory exists — 5 files (any-count.txt=0, api-tests.txt, tsc-*.txt)
[✓] task-3 directory exists — 1 file (ci.yml copy)
[✓] task-4 directory exists — 3 files (git-log.txt, merge-commit.txt, summary.txt)
[✗] task-5 directory MISSING — No .sisyphus/evidence/task-5/
[✗] task-6 directory MISSING — No .sisyphus/evidence/task-6/
[✗] task-7 directory MISSING — No .sisyphus/evidence/task-7/
[✗] task-8 directory MISSING — No .sisyphus/evidence/task-8/
[✗] task-9 directory MISSING — No .sisyphus/evidence/task-9/

Evidence Files: [4/9] present — tasks 5-9 evidence directories not created

---

ISSUES SUMMARY
==============

Critical:
  1. [VIOLATION] keystore/signing passwords hardcoded in build.gradle committed to git
     File: apps/mobile/android/app/build.gradle lines 22,24
     Value: "erp-release-2026" as fallback in both storePassword and keyPassword
     Risk: Anyone with repo access has the keystore password
     Fix: Remove fallback values, force env vars only: System.getenv("ERP_KEYSTORE_PASSWORD") (no fallback)

Non-Critical:
  2. Evidence files task-5 through task-9 are not present
     Deliverables themselves exist (APK, environment.android.ts, angular.json config, ProGuard, versioning)
     but the evidence tracking directories were not created for tasks 5-9

---

FINAL VERDICT: CONDITIONAL APPROVE
====================================

Functional work is COMPLETE:
  - 0 any types in production ✓
  - CI/CD pipeline with all required jobs ✓
  - Release APK (3.4MB, signed) ✓
  - environment.android.ts with absolute URL ✓
  - android build config in angular.json ✓
  - ProGuard/R8 enabled ✓
  - App versioning set ✓
  - Git worktree branches created and merged ✓
  - Firebase: placeholder only ✓
  - No Play Store / AAB / Fastlane config ✓

Blocking Issue:
  - Hardcoded password fallbacks "erp-release-2026" in committed build.gradle
    This violates Must NOT Have rule #7 (keystore/signing passwords を git にコミット)
    Severity: MEDIUM (passwords are in commits, but this is internal distribution APK, not critical)

Evidence Gap:
  - 5 of 9 evidence directories missing (tasks 5-9)
    However, the actual deliverables exist in codebase

RECOMMENDATION: 
  Before merging to production/distributing APK:
  1. Remove hardcoded password fallbacks from build.gradle (replace with error if env not set)
  2. Rotate keystore if build.gradle passwords are considered compromised
  Evidence gaps are administrative only — the work itself is done.

Must Have: [8/8] ✓
Must NOT Have: [10/11] — 1 violation (hardcoded passwords)
Evidence Files: [4/9] — 5 missing
Deliverables: [8/9 full + 1 partial]

REPORT END
